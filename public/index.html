<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morpha - AI Contract Assistant</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }

        /* Landing Page Styles */
        .landing-page {
            background: #f9f9f9;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #333;
        }

        .landing-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .landing-header h1 {
            font-size: 4em;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -2px;
            color: #667eea;
        }

        .landing-header p {
            font-size: 1.4em;
            color: #666;
            max-width: 600px;
        }

        .landing-upload {
        background: white;
        border-radius: 6px;
        padding: 20px 50px;
        text-align: center;
        border: 1px solid #ddd;
        transition: all 0.3s ease;
        cursor: pointer;
        max-width: 450px;
        width: 100%;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

        .landing-upload:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(0,0,0,0.12);
            transform: translateY(-1px);
        }

        .upload-icon {
            font-size: 2.5em;
            margin-bottom: 6px;
            color: #667eea;
        }

        .upload-text {
            font-size: 1.3em;
            margin-bottom: 3px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
        }

        .upload-subtext {
            color: #666;
            font-size: 1em;
            margin-bottom: 0;
        }

        .landing-footer {
            margin-top: 12px;
            text-align: center;
            max-width: 450px;
        }

        .terms-text {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        /* Main App Styles */
        .main-app {
            display: none;
            height: 100vh;
            overflow: hidden;
        }

        .app-header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .app-logo {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
        }

        .app-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-disabled {
    opacity: 0.6;
    cursor: not-allowed !important;
    position: relative;
}

.btn-disabled:hover {
    background: transparent !important;
    color: #667eea !important;
    transform: none !important;
}

.coming-soon-badge {
    font-size: 0.7em;
    background: #fbbf24;
    color: #92400e;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: 8px;
    font-weight: 600;
}

        .app-content {
            display: flex;
            height: calc(100vh - 70px);
        }

        .content-wrapper {
            display: flex;
            flex: 1;
            position: relative;
            width: 100%;
        }

        /* Ensure panels are flexible */
        .main-panel {
            flex: 1 1 60%;
            min-width: 300px;
            max-width: 75%;
        }

        .chat-panel {
            flex: 0 0 350px;
            min-width: 250px;
            max-width: 500px;
        }

        .panel-resizer {
            width: 5px;
            background: #f0f0f0;
            cursor: col-resize;
            position: relative;
            transition: background 0.2s ease;
            flex-shrink: 0;
            z-index: 10;
        }

        .panel-resizer:hover {
            background: #667eea;
        }

        .panel-resizer::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 30px;
            background: #ccc;
            border-radius: 1px;
        }

        .panel-resizer:hover::after {
            background: white;
        }

        .panel-resizer:hover {
            background: #667eea;
        }

        .panel-resizer::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 30px;
            background: #ccc;
            border-radius: 1px;
        }

        .panel-resizer:hover::after {
            background: white;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 25px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 60px;
            padding: 25px 15px;
        }
        .sidebar.collapsed .sidebar-section {
    display: none;
}

.sidebar.collapsed .upload-btn {
    display: none;
}

.sidebar.collapsed .sidebar-toggle {
    margin-bottom: 0;
    text-align: center;
    font-size: 1.4em;
}

/* Optional: Add a tooltip for the collapsed toggle button */
.sidebar.collapsed .sidebar-toggle {
    position: relative;
}

.sidebar.collapsed .sidebar-toggle:hover::after {
    content: 'Expand sidebar';
    position: absolute;
    left: 70px;
    top: 50%;
    transform: translateY(-50%);
    background: #333;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.8em;
    white-space: nowrap;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.sidebar.collapsed .sidebar-toggle:hover::before {
    content: '';
    position: absolute;
    left: 62px;
    top: 50%;
    transform: translateY(-50%);
    border: 6px solid transparent;
    border-right-color: #333;
    z-index: 1000;
}

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            margin-bottom: 20px;
            color: #666;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }

        .category-item:hover {
            background: #f0f2ff;
        }

        .category-item.active {
            background: #e8ebff;
            border-left: 4px solid #667eea;
        }

        .category-name {
            font-weight: 500;
            color: #333;
        }

        .category-count {
            background: #667eea;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .upload-btn {
            background: white;
            padding: 35px 60px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .upload-btn:hover {
            background: #5a6fd8;
        }

        /* Main Panel */
        .main-panel {
    flex: 1;
    background: white;
    display: flex;
    flex-direction: column;
    min-height: 0;
    height: calc(100vh - 70px);
    overflow: hidden;
}

        .document-header {
            padding: 25px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9ff;
        }

        .document-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .document-meta {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .doc-type {
            background: #e8ebff;
            color: #667eea;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .risk-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }

        .document-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            background: white;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9ff;
        }

        .tab:hover:not(.active) {
            color: #333;
            background: #f5f5f5;
        }

       .document-content {
    flex: 1;
    padding: 25px;
    overflow-y: auto;
    min-height: 0;
    scrollbar-width: thin;
    scrollbar-color: #667eea #f1f1f1;
}

        .document-content::-webkit-scrollbar {
            width: 8px;
        }

        .document-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .document-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .document-content::-webkit-scrollbar-thumb:hover {
            background: #5a6fd8;
        }

        /* Ensure content sections are scrollable */
        .content-section {
    display: none;
}

.content-section.active {
    display: block;
}

        .summary-grid, .red-flags {
            margin-bottom: 50px;
        }

        /* Chat Panel */
        .chat-panel {
            width: 350px;
            background: white;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
        padding: 15px 20px 12px 20px;
        border-bottom: 1px solid #e0e0e0;
        background: #f8f9ff;
        }

        .chat-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .chat-subtitle {
            color: #666;
            font-size: 0.9em;
        }

        .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 5px;
            text-align: center;
        }

        .subtitle-secondary {
            font-size: 0.6em;
            color: #888;
            margin-top: 10px;
            margin-bottom: 13px;
            font-style: italic;
            text-align: center;
        }

        .chat-subtitle {
            color: #666;
            font-size: 0.9em;
        }
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            max-width: 85%;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: #667eea;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.ai .message-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .suggested-questions {
            padding: 12px 15px;
            border-top: 1px solid #e0e0e0;
            background: white;
        }

        .suggestions-title {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .suggestion-btn {
            display: block;
            width: 100%;
            background: #f8f9ff;
            border: 1px solid #e0e0e0;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 5px;
            cursor: pointer;
            font-size: 0.85em;
            text-align: left;
            transition: all 0.3s ease;
        }

        .suggestion-btn:hover {
            background: #e8ebff;
            border-color: #667eea;
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            background: white;
        }

        .input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .summary-grid {
    display: grid;
    gap: 20px;
    margin-bottom: 30px;
    overflow-y: auto;
    padding-right: 10px;
    max-height: calc(100vh - 350px);
}

        .summary-card {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .summary-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .summary-card p, .summary-card ul {
            color: #666;
            line-height: 1.5;
        }

        .summary-card ul {
            padding-left: 20px;
        }

        .red-flags {
    display: grid;
    gap: 15px;
    overflow-y: auto;
    padding-right: 10px;
    max-height: calc(100vh - 350px);
}

        .flag-item {
    background: #fff5f5;
    border: 1px solid #fed7d7;
    border-radius: 8px;
    padding: 15px;
    border-left: 4px solid #e53e3e;
    margin-bottom: 10px;
    flex-shrink: 0;
}

        .flag-title {
            font-weight: 600;
            color: #e53e3e;
            margin-bottom: 5px;
        }

        .flag-description {
            color: #666;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        #fileInput {
            display: none;
        }
        /* Typing indicator animation */
.typing-indicator .message-content {
    background: #f0f0f0 !important;
    border: 1px solid #e0e0e0 !important;
}

.typing-animation {
    display: flex;
    gap: 4px;
    padding: 8px 0;
}

.typing-animation span {
    width: 8px;
    height: 8px;
    background: #666;
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-animation span:nth-child(1) { animation-delay: -0.32s; }
.typing-animation span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
}

/* Error message styling */
.error-message {
    background: #fee !important;
    border: 1px solid #fcc !important;
    color: #c33 !important;
}

/* Disabled input styling */
.chat-input input:disabled {
    background: #f5f5f5;
    color: #999;
    cursor: not-allowed;
}

.send-btn:disabled {
    background: #ccc !important;
    cursor: not-allowed;
}

/* Enhanced send button states */
.send-btn {
    transition: all 0.3s ease;
    font-weight: bold;
}

.send-btn:hover:not(:disabled) {
    background: #5a6fd8;
    transform: scale(1.1);
}

/* Custom scrollbar for red flags and summary */
.red-flags::-webkit-scrollbar,
.summary-grid::-webkit-scrollbar {
    width: 8px;
}

.red-flags::-webkit-scrollbar-track,
.summary-grid::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.red-flags::-webkit-scrollbar-thumb,
.summary-grid::-webkit-scrollbar-thumb {
    background: #667eea;
    border-radius: 4px;
}

.red-flags::-webkit-scrollbar-thumb:hover,
.summary-grid::-webkit-scrollbar-thumb:hover {
    background: #5a6fd8;
}

/* Fix PDF viewer */
#pdfViewer {
    width: 100%;
    height: calc(100vh - 350px) !important;
    min-height: 500px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
}

/* Large prominent demo button */
.demo-privacy-btn-large {
    background: #667eea;
    color: white;
    border: none;
    padding: 18px 40px;
    border-radius: 8px;
    font-size: 1.2em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 8px;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    display: block;
    margin-left: auto;
    margin-right: auto;
}

.demo-privacy-btn-large:hover {
    background: #5a6fd8;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

/* Subtext under demo button */
.demo-subtext {
    color: #666;
    font-size: 0.95em;
    margin: 0;
    text-align: center;
    font-style: italic;
}

/* Feedback Modal Styles */
.modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: white;
    border-radius: 12px;
    padding: 0;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #333;
}

.close {
    font-size: 24px;
    cursor: pointer;
    color: #999;
}

.close:hover {
    color: #333;
}

.modal-body {
    padding: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #333;
}

.form-group select,
.form-group textarea,
.form-group input {
    width: 100%;
    padding: 12px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
    box-sizing: border-box;
}

.form-group textarea {
    resize: vertical;
    min-height: 120px;
}

.form-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
}

.btn-primary {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
}

.btn-primary:hover {
    background: #5a6fd8;
}

.btn-primary:disabled {
    background: #ccc;
    cursor: not-allowed;
}

/* Mobile Header Buttons */
.mobile-header-actions {
    display: none;
    gap: 10px;
}

.mobile-menu-btn,
.mobile-chat-btn {
    background: #667eea;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 500;
}

.mobile-menu-btn:hover,
.mobile-chat-btn:hover {
    background: #5a6fd8;
}

/* Mobile Layout */
@media (max-width: 768px) {
    /* Show mobile buttons, hide desktop buttons */
    .mobile-header-actions {
        display: flex;
    }
    
    .app-actions {
        display: none;
    }
    
    /* App content mobile layout */
    .app-content {
        flex-direction: column;
        height: calc(100vh - 60px);
    }
    
    /* Hide sidebar by default on mobile */
    .sidebar {
        display: none;
        position: fixed;
        top: 60px;
        left: 0;
        width: 80%;
        height: calc(100vh - 60px);
        background: white;
        z-index: 1000;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        overflow-y: auto;
    }
    
    .sidebar.mobile-open {
        display: block;
    }
    
    /* Mobile overlay when sidebar is open */
    .mobile-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 999;
    }
    
    .mobile-overlay.active {
        display: block;
    }
    
    /* Main content takes full width on mobile */
    .main-panel {
        flex: 1;
        max-width: 100%;
        min-width: 100%;
    }
    
    /* Hide chat panel and resizer on mobile */
    .chat-panel {
        display: none;
    }
    
    .panel-resizer {
        display: none;
    }
    
    /* Make document content scrollable */
    .document-content {
        max-height: calc(100vh - 200px);
        overflow-y: auto;
    }
}

/* Mobile Chat Modal */
.mobile-chat-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
}

.mobile-chat-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 90vh;
    background: white;
    border-radius: 12px 12px 0 0;
    display: flex;
    flex-direction: column;
}

.mobile-chat-header {
    padding: 15px 20px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.mobile-chat-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.mobile-chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.mobile-chat-input {
    padding: 15px 20px;
    border-top: 1px solid #e0e0e0;
    display: flex;
    gap: 10px;
}

.mobile-chat-input input {
    flex: 1;
    padding: 12px;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
}

.mobile-chat-input button {
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
}

@media (max-width: 768px) {
    .mobile-chat-modal {
        display: block;
    }
}

.mobile-suggested-questions {
    padding: 15px 20px;
    border-top: 1px solid #e0e0e0;
    max-height: 120px;
    overflow-y: auto;
}

.mobile-suggested-questions .suggestion-btn {
    display: block;
    width: 100%;
    background: #f8f9ff;
    border: 1px solid #e0e0e0;
    padding: 10px 12px;
    border-radius: 6px;
    margin-bottom: 8px;
    cursor: pointer;
    font-size: 0.85em;
    text-align: left;
}

.mobile-suggested-questions .suggestion-btn:hover {
    background: #e8ebff;
    border-color: #667eea;
}

</style>


</head>
<body>

<!-- Cookie Consent Banner -->
<div id="cookieConsent" style="display: none; position: fixed; bottom: 0; left: 0; right: 0; background: #333; color: white; padding: 20px; z-index: 10000; box-shadow: 0 -2px 10px rgba(0,0,0,0.2);">
    <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
        <div style="flex: 1; min-width: 300px;">
            <p style="margin: 0;">We collect non-personal data to operate our service: anonymous usage counts (e.g., # of document uploads, feature clicks, # of chat interactions) and technical logs for troubleshooting. All data is automatically deleted within 30 days.</p>
            <a href="/privacy" target="_blank" style="color: #667eea; text-decoration: underline;">Learn more</a>
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="acceptCookies(true)" style="padding: 10px 20px; background: #667eea; border: none; color: white; border-radius: 4px; cursor: pointer;">Proceed</button>
        </div>
    </div>
</div>



    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
        <div class="landing-header">
            <h1>Morpha</h1>
            <p class="subtitle">Your AI assistant that turns confusing contracts into clear, actionable insights</p>
            <p class="subtitle-secondary">No more worrying about hidden clauses and fine print</p>
        </div>
        
        <div class="landing-upload" id="landingUpload">
            <div class="upload-icon">ðŸ“„</div>
            <div class="upload-text">Upload your document</div>
            <div class="upload-subtext">PDF and Word documents supported</div>
        </div>
        
    <div class="landing-footer">
    <!-- Divider text -->
    <p style="text-align: center; color: #999; font-size: 0.9em; margin: 20px 0 15px 0;">
        â”€â”€â”€â”€ or try a demo first â”€â”€â”€â”€
    </p>
    
    <!-- Prominent Demo Button -->
    <button class="demo-privacy-btn-large" id="demoPrivacyBtn">
        Try Morpha Now
    </button>
    <p class="demo-subtext">See it yourself, analyze our privacy policy</p>
    
    <!-- Small Privacy Policy Link -->
    <div style="margin-top: 25px;">
        <a href="/privacy" target="_blank" style="color: #999; text-decoration: none; font-size: 0.85em;">or view our full privacy policy</a>
    </div>
</div>
        
        <input type="file" id="fileInput" accept=".pdf,.doc,.docx">
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <!-- Header -->
        <div class="app-header">
            <div class="app-logo">Morpha</div>

                <!-- Mobile-only buttons -->
            <div class="mobile-header-actions">
                <button class="mobile-menu-btn" id="mobileMenuBtn">â˜°</button>
                <button class="mobile-chat-btn" id="mobileChatBtn">ðŸ’¬ Chat</button>
            </div>
            
            <!-- Desktop buttons -->
                    <div class="app-actions">
                <button class="btn-secondary btn-disabled" disabled title="Coming Soon - Export functionality will be available in a future update">
    Export Summary <span class="coming-soon-badge">Coming Soon</span>
                </button>
                <button class="btn-secondary" id="feedbackBtn">Give Feedback</button>
            </div>
        </div>

        <div class="app-content">
        <div class="mobile-overlay" id="mobileOverlay"></div>
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
                
                <div class="sidebar-section">
    <div class="sidebar-title">Document Categories</div>
    <div class="category-item" data-category="Rental/Lease Agreement">
        <span class="category-name">Rental/Lease Agreements</span>
        <span class="category-count">0</span>
    </div>
    <div class="category-item" data-category="Employment Contract">
        <span class="category-name">Employment Contracts</span>
        <span class="category-count">0</span>
    </div>
    <div class="category-item" data-category="Brand Partnership/Sponsorship">
        <span class="category-name">Brand Partnerships</span>
        <span class="category-count">0</span>
    </div>
    <div class="category-item" data-category="Loan Document">
        <span class="category-name">Loan Documents</span>
        <span class="category-count">0</span>
    </div>
    <div class="category-item" data-category="NDA/Confidentiality">
        <span class="category-name">NDAs/Confidentiality</span>
        <span class="category-count">0</span>
    </div>
    <div class="category-item" data-category="User Agreement">
        <span class="category-name">User Agreements</span>
        <span class="category-count">0</span>
    </div>
    <div class="category-item" data-category="Other">
        <span class="category-name">Other</span>
        <span class="category-count">0</span>
    </div>
</div>

                <button class="upload-btn" id="uploadNewBtn">Upload New Document</button>
                <button class="upload-btn btn-disabled" disabled title="Coming Soon - User accounts will be available in a future update">
                    <span>Create Account</span>
                    <span class="coming-soon-badge">Coming Soon</span>
                </button>
            </div>

            <!-- Main Panel -->
            <div class="main-panel">
                <!-- Loading State -->
                <div class="loading" id="loadingSection">
                    <div class="spinner"></div>
                    <h3>Analyzing your contract...</h3>
                    <p>Reviewing the document and identifying key terms</p>
                </div>

                <!-- Document Content -->
                <div id="documentContent" class="hidden">
                    <div class="document-header">
                        <div class="document-title" id="documentTitle">Contract Analysis</div>
                        <div class="document-meta">
                            <span class="doc-type" id="docType">Document Type</span>
                            <span class="risk-badge" id="riskBadge">Risk Level</span>
                        </div>
                    </div>

                    <div class="document-tabs">
                        <div class="tab active" data-tab="summary">Summary</div>
                        <div class="tab" data-tab="red-flags">Red Flags</div>
                        <div class="tab" data-tab="full-text">Full Document</div>
                    </div>

                    <div class="document-content">
                        <!-- Summary Tab -->
                        <div class="content-section active" id="summary-content">
                            <div class="summary-grid" id="summaryGrid">
                                <!-- Summary content will be inserted here -->
                            </div>
                        </div>

                        <!-- Red Flags Tab -->
                        <div class="content-section" id="red-flags-content">
                            <div class="red-flags" id="redFlagsContainer">
                                <!-- Red flags will be inserted here -->
                            </div>
                        </div>

                        <!-- Full Text Tab -->
                        <div class="content-section" id="full-text-content">
                            <div id="pdfViewer">
                                <!-- PDF will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

           <!-- Panel Resizer -->
            <div class="panel-resizer" id="panelResizer"></div>
            <!-- Chat Panel -->
            <div class="chat-panel">
                <div class="chat-header">
                    <div class="chat-title">Chat with the document</div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <!-- Chat messages will appear here -->
                    </div>
                        <div class="suggested-questions" id="suggestedQuestions">
                        <div class="suggestions-title">Questions to consider:</div>
                    </div>

                    <div class="chat-input">
                    <div class="input-container">
                        <input type="text" id="chatInput" placeholder="Ask a question...">
                        <button class="send-btn" id="sendBtn">â†’</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
    let currentDocumentId = null;
    let lastUploadedFile = null;
    let isCollapsed = false;
    let isResizing = false;

    // Cookie consent management
function checkCookieConsent() {
    const consent = localStorage.getItem('cookieConsent');
    if (!consent) {
        document.getElementById('cookieConsent').style.display = 'block';
    }
}

window.acceptCookies = function(allowAnalytics) {
    const consentData = {
        essential: true,
        analytics: allowAnalytics,
        timestamp: new Date().toISOString()
    };
    localStorage.setItem('cookieConsent', JSON.stringify(consentData));
    document.getElementById('cookieConsent').style.display = 'none';
    
    if (allowAnalytics) {
        // Initialize analytics here when you add them
        console.log('Analytics enabled');
    }
}

// Check consent on page load
checkCookieConsent();

    // DOM elements - now safely accessible after DOM is loaded
    const landingPage = document.getElementById('landingPage');
    const mainApp = document.getElementById('mainApp');
    const landingUpload = document.getElementById('landingUpload');
    const fileInput = document.getElementById('fileInput');
    const uploadNewBtn = document.getElementById('uploadNewBtn');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const loadingSection = document.getElementById('loadingSection');
    const documentContent = document.getElementById('documentContent');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatMessages = document.getElementById('chatMessages');
    const mainPanel = document.querySelector('.main-panel');
    const chatPanel = document.querySelector('.chat-panel');

    // Upload triggers
landingUpload.addEventListener('click', () => {
    // Landing page upload - no state reset needed
    fileInput.dataset.uploadType = 'initial';
    fileInput.value = ''; // Reset to allow same file selection
    fileInput.click();
});

uploadNewBtn.addEventListener('click', () => {
    // Upload new document - needs state reset
    fileInput.dataset.uploadType = 'new';
    fileInput.value = ''; // Reset to allow same file selection
    fileInput.click();
});

fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        const uploadType = fileInput.dataset.uploadType || 'initial';
        const newFile = e.target.files[0];
        
        // Check if it's the same document being uploaded again
        if (uploadType === 'new' && currentDocumentId && lastUploadedFile) {
            if (isSameFile(newFile, lastUploadedFile)) {
                // Show confirmation dialog for same document
                const userChoice = confirm(
                    `You are currently reviewing "${lastUploadedFile.name}".\n\n` +
                    `Do you want to start analyzing this document from scratch?\n\n` +
                    `â€¢ Click "OK" to restart analysis\n` +
                    `â€¢ Click "Cancel" to continue with current analysis`
                );
                
                if (!userChoice) {
                    // User chose to cancel - reset file input and return
                    fileInput.value = '';
                    return;
                }
                // User chose to restart - continue with reset and upload
            }
        }
        
        if (uploadType === 'new') {
            // Reset state before uploading new document
            resetApplicationState();
        }
        
        // Store file info for future comparison
        lastUploadedFile = {
            name: newFile.name,
            size: newFile.size,
            type: newFile.type,
            lastModified: newFile.lastModified
        };
        
        handleFileUpload(newFile);
    }
});

// Handle click on file input to detect same file attempts
fileInput.addEventListener('click', (e) => {
    const uploadType = fileInput.dataset.uploadType || 'initial';
    
    // Only check for new document uploads
    if (uploadType === 'new' && currentDocumentId && lastUploadedFile) {
        // Store current file list to compare after selection
        fileInput.dataset.wasEmpty = fileInput.files.length === 0;
    }
});

// Handle focus to catch when user cancels file dialog with same file
fileInput.addEventListener('focus', (e) => {
    const uploadType = fileInput.dataset.uploadType || 'initial';
    
    if (uploadType === 'new' && currentDocumentId && lastUploadedFile && fileInput.dataset.wasEmpty === 'true') {
        // Small delay to allow file dialog to process
        setTimeout(() => {
            // If still no files selected but we had a lastUploadedFile, user might have tried same file
            if (fileInput.files.length === 0) {
                // This means user opened dialog but didn't select anything
                // We can't detect if they tried to select the same file, so do nothing
            }
        }, 100);
    }
});


// Compare if two files are the same
function isSameFile(file1, file2) {
    return file1.name === file2.name && 
           file1.size === file2.size && 
           file1.type === file2.type &&
           Math.abs(file1.lastModified - file2.lastModified) < 1000; // 1 second tolerance
}

// Reset application state for new document uploads
function resetApplicationState() {
    console.log('Resetting application state for new document...');
    
    // Clear current document
    currentDocumentId = null;
    
    // ENHANCED: Clear chat messages more thoroughly
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        // Clear all messages
        chatMessages.innerHTML = '';
        console.log('Chat messages cleared');
    }
    
    // Clear chat input
    const chatInput = document.getElementById('chatInput');
    if (chatInput) {
        chatInput.value = '';
        chatInput.disabled = false;
        chatInput.placeholder = 'Ask a question...';
    }
    
    // Reset send button
    const sendBtn = document.getElementById('sendBtn');
    if (sendBtn) {
        sendBtn.disabled = false;
        sendBtn.textContent = 'â†’';
    }
    
    // Clear document content areas
    const summaryGrid = document.getElementById('summaryGrid');
    if (summaryGrid) {
        summaryGrid.innerHTML = '';
    }
    
    const redFlagsContainer = document.getElementById('redFlagsContainer');
    if (redFlagsContainer) {
        redFlagsContainer.innerHTML = '';
    }
    
    const pdfViewer = document.getElementById('pdfViewer');
    if (pdfViewer) {
        pdfViewer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">Upload a document to view it here</div>';
    }
    
    // Clear suggested questions
    const suggestedQuestions = document.getElementById('suggestedQuestions');
    if (suggestedQuestions) {
        suggestedQuestions.innerHTML = '<div class="suggestions-title">Questions to consider:</div>';
    }
    
    // Reset document header
    const documentTitle = document.getElementById('documentTitle');
    if (documentTitle) {
        documentTitle.textContent = 'Contract Analysis';
    }
    
    const docType = document.getElementById('docType');
    if (docType) {
        docType.textContent = 'Document Type';
    }
    
    const riskBadge = document.getElementById('riskBadge');
    if (riskBadge) {
        riskBadge.textContent = 'Risk Level';
        riskBadge.className = 'risk-badge';
    }
    
    // Reset to summary tab
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.tab === 'summary') {
            tab.classList.add('active');
        }
    });
    
    document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
        if (section.id === 'summary-content') {
            section.classList.add('active');
        }
    });
    
    // Reset file input
    fileInput.value = '';
    
    // Force scroll chat to top
    if (chatMessages) {
        chatMessages.scrollTop = 0;
    }
    
    console.log('Application state reset complete - chat history cleared');
}

    // Sidebar toggle
    sidebarToggle.addEventListener('click', () => {
    isCollapsed = !isCollapsed;
    sidebar.classList.toggle('collapsed', isCollapsed);
    
    // Enhanced toggle button text with better icons
    if (isCollapsed) {
        sidebarToggle.textContent = 'â†’';
        sidebarToggle.title = 'Expand sidebar';
        console.log('Sidebar collapsed');
    } else {
        sidebarToggle.textContent = 'â˜°';
        sidebarToggle.title = 'Collapse sidebar';
        console.log('Sidebar expanded');
    }
    
    // Optional: Save collapse state to localStorage for persistence
    try {
        localStorage.setItem('sidebarCollapsed', isCollapsed);
    } catch (e) {
        // localStorage not available, that's fine
    }
});

// Restore sidebar collapse state on page load
try {
    const savedState = localStorage.getItem('sidebarCollapsed');
    if (savedState === 'true') {
        isCollapsed = true;
        sidebar.classList.add('collapsed');
        sidebarToggle.textContent = 'â†’';
        sidebarToggle.title = 'Expand sidebar';
    } else {
        sidebarToggle.title = 'Collapse sidebar';
    }
} catch (e) {
    // localStorage not available, use default state
    sidebarToggle.title = 'Collapse sidebar';
}

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        // Remove active class from all tabs
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-content').classList.add('active');
        
        // NEW: Track viewing red flags tab
        if (tab.dataset.tab === 'red-flags' && currentDocumentId) {
            trackAction('view_red_flags');
        }
    });
    });

    // Panel resizing functionality with debugging
    let startX, startMainWidth, startChatWidth;
    const panelResizer = document.getElementById('panelResizer');

    console.log('Panel resizer element:', panelResizer);
    console.log('Main panel:', mainPanel);
    console.log('Chat panel:', chatPanel);

    if (panelResizer) {
        console.log('Panel resizer found, adding event listener');
        
        panelResizer.addEventListener('mousedown', (e) => {
            console.log('Mouse down on resizer');
            isResizing = true;
            startX = e.clientX;
            
            const mainRect = mainPanel.getBoundingClientRect();
            const chatRect = chatPanel.getBoundingClientRect();
            
            startMainWidth = mainRect.width;
            startChatWidth = chatRect.width;
            
            console.log('Start widths - Main:', startMainWidth, 'Chat:', startChatWidth);
            
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
            
            e.preventDefault();
        });

         // ADD: Double-click to reset
    panelResizer.addEventListener('dblclick', resetPanelSizes);

    } else {
        console.error('Panel resizer not found!');
    }

    function handleMouseMove(e) {
    if (!isResizing) return;
    
    const deltaX = e.clientX - startX;
    console.log('Mouse move, deltaX:', deltaX);
    
    // Calculate new widths
    const newMainWidth = startMainWidth + deltaX;
    const newChatWidth = startChatWidth - deltaX;
    
    console.log('New widths - Main:', newMainWidth, 'Chat:', newChatWidth);
    
    // Set reasonable constraints
    const minMainWidth = 300;
    const minChatWidth = 250;
    
    // Check constraints
    if (newMainWidth >= minMainWidth && newChatWidth >= minChatWidth) {
        
        // WORKING FIX: Override flex properties completely
        mainPanel.style.flex = 'none';
        mainPanel.style.width = newMainWidth + 'px';
        mainPanel.style.minWidth = newMainWidth + 'px';
        mainPanel.style.maxWidth = newMainWidth + 'px';
        
        chatPanel.style.flex = 'none';
        chatPanel.style.width = newChatWidth + 'px';
        chatPanel.style.minWidth = newChatWidth + 'px';
        chatPanel.style.maxWidth = newChatWidth + 'px';
        
        console.log('Applied new widths - forcing override');
    } else {
        console.log('Constraints not met - Main:', newMainWidth, 'Chat:', newChatWidth);
    }
}

// Reset function for default layout
function resetPanelSizes() {
    // Reset to original CSS flex values
    mainPanel.style.flex = '1 1 60%';
    mainPanel.style.width = '';
    mainPanel.style.minWidth = '300px';
    mainPanel.style.maxWidth = '75%';
    
    chatPanel.style.flex = '0 0 350px';
    chatPanel.style.width = '';
    chatPanel.style.minWidth = '250px';
    chatPanel.style.maxWidth = '500px';
    
    console.log('Panel sizes reset to default');
}

    function handleMouseUp() {
        console.log('Mouse up - stopping resize');
        isResizing = false;
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
    }

    // Chat functionality - THIS IS THE KEY FIX!
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    sendBtn.addEventListener('click', sendMessage);

    // File upload handler
    async function handleFileUpload(file) {
        // Validate file
        const allowedTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
        if (!allowedTypes.includes(file.type)) {
            alert('Please upload a PDF or Word document.');
            return;
        }

        if (file.size > 10 * 1024 * 1024) {
            alert('File size must be less than 10MB.');
            return;
        }
         
        // Track real uploads (not privacy demo)
    if (file.name !== 'Morpha_Privacy_Policy.pdf') {
        try {
            await fetch('/track', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    event: 'personal_upload',
                    session_id: sessionStorage.getItem('session_id') || generateSessionId()
                })
            });
        } catch (e) {
            // Silent fail - don't break user experience
        }
    }


        // Switch to main app and show loading
        landingPage.style.display = 'none';
        mainApp.style.display = 'block';
        loadingSection.classList.remove('hidden');
        documentContent.classList.add('hidden');

        // Upload file
        const formData = new FormData();
        formData.append('document', file);

        try {
            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                currentDocumentId = result.documentId;
                displayAnalysis(result.analysis, file.name);
                loadSuggestedQuestions();
                // Ensure chat is cleared for new document
if (document.getElementById('chatMessages')) {
    document.getElementById('chatMessages').innerHTML = '';
    console.log('Chat cleared after successful upload');
}
                
                // Hide loading and show content
                loadingSection.classList.add('hidden');
                documentContent.classList.remove('hidden');
            } else {
                throw new Error(result.error || 'Upload failed');
            }
        } catch (error) {
            console.error('Upload error:', error);
            alert('Failed to upload and analyze document: ' + error.message);
            // Go back to landing page
            landingPage.style.display = 'flex';
            mainApp.style.display = 'none';
        }
    }

// Generate session ID (resets when tab closes)
function generateSessionId() {
    const id = Math.random().toString(36).substring(2) + Date.now().toString(36);
    sessionStorage.setItem('session_id', id);
    return id;
}

// Track meaningful actions
async function trackAction(action) {
    try {
        const sessionId = sessionStorage.getItem('session_id') || generateSessionId();
        await fetch('/track', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                event: action,
                session_id: sessionId
            })
        });
    } catch (e) {
        // Silent fail
    }
}    

    

    // Display analysis results
    function displayAnalysis(analysis, filename) {
        // Update document header
        document.getElementById('documentTitle').textContent = filename;
        document.getElementById('docType').textContent = analysis.documentType;
        updateCategoryCount(analysis.documentType);        

        const riskBadge = document.getElementById('riskBadge');
        riskBadge.textContent = `${analysis.riskLevel} Risk`;
        riskBadge.className = `risk-badge risk-${analysis.riskLevel}`;

        // Update summary
        const summaryGrid = document.getElementById('summaryGrid');
        let summaryHtml = `
            <div class="summary-card">
                <h4>ðŸ“„ Document Summary</h4>
                <p>${analysis.summary}</p>
                ${analysis.isScanned ? '<p><em>Note: This appears to be a scanned document. Some features may be limited.</em></p>' : ''}
            </div>
        `;
        
        if (analysis.keyDates && analysis.keyDates.length > 0) {
            summaryHtml += `
                <div class="summary-card">
                    <h4>ðŸ“… Important Dates</h4>
                    <ul>
                        ${analysis.keyDates.map(date => `<li>${date}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        if (analysis.financialTerms && analysis.financialTerms.length > 0) {
            summaryHtml += `
                <div class="summary-card">
                    <h4>ðŸ’° Financial Terms</h4>
                    <ul>
                        ${analysis.financialTerms.map(term => `<li>${term}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        summaryGrid.innerHTML = summaryHtml;

        // Update red flags
        const redFlagsContainer = document.getElementById('redFlagsContainer');
        if (analysis.risks && analysis.risks.length > 0) {
            redFlagsContainer.innerHTML = analysis.risks.map(risk => `
                <div class="flag-item">
                    <div class="flag-title">âš ï¸ Potential Issue</div>
                    <div class="flag-description">${risk}</div>
                </div>
            `).join('');
        } else {
            redFlagsContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <h3>âœ… No major red flags detected</h3>
                    <p>This document appears to have standard terms and conditions.</p>
                </div>
            `;
        }

        // Load PDF viewer
        loadPDFViewer();
    }

    // Update sidebar category counts
function updateCategoryCount(documentType) {
    console.log('Updating category count for:', documentType);
    
    // Reset all counts first
    document.querySelectorAll('.category-count').forEach(count => {
        count.textContent = '0';
    });
    
    // Remove active class from all categories
    document.querySelectorAll('.category-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Find and update the matching category
    const categoryItems = document.querySelectorAll('.category-item');
    categoryItems.forEach(item => {
        const categoryData = item.getAttribute('data-category');
        if (categoryData === documentType) {
            // Set count to 1 for current document
            const countElement = item.querySelector('.category-count');
            if (countElement) {
                countElement.textContent = '1';
            }
            // Add active class
            item.classList.add('active');
            console.log('Updated count for category:', categoryData);
        }
    });
}

    // Load suggested questions
    async function loadSuggestedQuestions() {
    try {
        const response = await fetch(`/suggestions/${currentDocumentId}`);
        const result = await response.json();

        if (result.success) {
            const container = document.getElementById('suggestedQuestions');
            
            // Create buttons that call the global askQuestion function
            const questionsHtml = result.suggestions.map((question, index) =>
                `<button class="suggestion-btn" data-question="${question.replace(/"/g, '&quot;')}" onclick="window.askQuestion('${question.replace(/'/g, "\\'").replace(/"/g, '\\"')}')">${question}</button>`
            ).join('');
            
            container.innerHTML = `
            <div class="suggestions-title">Chat with the document:</div>
            ${questionsHtml}
            `;

            // Also add click event listeners as backup
            container.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const question = this.getAttribute('data-question');
                    if (question && window.askQuestion) {
                        window.askQuestion(question);
                    }
                });
            });
        }
    } catch (error) {
        console.error('Failed to load suggestions:', error);
        // Add fallback suggestions if API fails
        const container = document.getElementById('suggestedQuestions');
        container.innerHTML = `
            <div class="suggestions-title">Questions to consider:</div>
            <button class="suggestion-btn" onclick="window.askQuestion('What are the most important terms I should know?')">What are the most important terms I should know?</button>
            <button class="suggestion-btn" onclick="window.askQuestion('Are there any red flags in this contract?')">Are there any red flags in this contract?</button>
            <button class="suggestion-btn" onclick="window.askQuestion('What are my main obligations?')">What are my main obligations?</button>
            <button class="suggestion-btn" onclick="window.askQuestion('What happens if I want to cancel?')">What happens if I want to cancel?</button>
        `;
    }
}

    // Ask suggested question - Make this globally available
    window.askQuestion = function(question) {
        chatInput.value = question;
        sendMessage();
    }

    // Send chat message
    async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message || !currentDocumentId) {
        console.log('No message or document ID');
        return;
    }

    // Prevent multiple simultaneous requests
    if (chatInput.disabled) {
        console.log('Chat request already in progress');
        return;
    }

    console.log('Sending message:', message);

    // Add user message
    addMessage(message, 'user');
    chatInput.value = '';

    // Disable input with visual feedback
    chatInput.disabled = true;
    sendBtn.disabled = true;
    sendBtn.textContent = '...';

    // Add "AI is typing" indicator
    const typingIndicator = addTypingIndicator();

    try {
        console.log('Making fetch request to /chat');
        
        const response = await fetch('/chat', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                documentId: currentDocumentId,
                message: message
            })
        });

         
        console.log('Response status:', response.status);
        
        // Remove typing indicator
        if (typingIndicator && typingIndicator.parentNode) {
            typingIndicator.remove();
        }

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        console.log('Response result:', result);

        if (result.success && result.response) {
            addMessage(result.response, 'ai');
        } else {
            // Handle API errors
            const errorMsg = result.error || 'No response from AI';
            console.error('API Error:', errorMsg);
            
            if (response.status === 429) {
                const retryAfter = result.retryAfter || 60;
                addMessage(`â° Please wait ${retryAfter} seconds before sending another message.`, 'ai error');
                startCooldownTimer(retryAfter);
            } else {
                addMessage(`API Error: ${errorMsg}`, 'ai error');
            }
        }
    } catch (error) {
        console.error('Chat error details:', error);
        
        // Remove typing indicator if still there
        if (typingIndicator && typingIndicator.parentNode) {
            typingIndicator.remove();
        }

        // Enhanced error messages
        let errorMessage = 'Sorry, I encountered an error. Please try again.';
        
        if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
            errorMessage = 'ðŸ”Œ Connection issue. Please check your internet and try again.';
        } else if (error.message.includes('429') || error.message.includes('rate limit')) {
            errorMessage = 'â° Too many requests. Please wait a moment before trying again.';
            startCooldownTimer(60);
        } else if (error.message.includes('404')) {
            errorMessage = 'ðŸ“„ Document not found. Please upload a new document.';
        } else if (error.message.includes('500')) {
            errorMessage = 'ðŸ”§ Server error. Please try again in a moment.';
        }
        
        addMessage(errorMessage, 'ai error');
    } finally {
        // Always restore input functionality
        setTimeout(() => {
            chatInput.disabled = false;
            sendBtn.disabled = false;
            sendBtn.textContent = 'â†’';
            chatInput.focus();
        }, 1000);
    }
}

// Make sure askQuestion is globally available
window.askQuestion = function(question) {
    console.log('askQuestion called with:', question);
    if (chatInput && question) {
        chatInput.value = question;
        sendMessage();
    } else {
        console.error('Chat input not found or no question provided');
    }
}

// Add typing indicator function
function addTypingIndicator() {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message ai typing-indicator';
    messageDiv.innerHTML = `
        <div class="message-content">
            <div class="typing-animation">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    `;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return messageDiv;
}

// Cooldown timer for rate limiting
function startCooldownTimer(seconds) {
    const timerDisplay = document.createElement('div');
    timerDisplay.className = 'cooldown-timer';
    timerDisplay.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff6b6b;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    
    document.body.appendChild(timerDisplay);
    
    let remaining = seconds;
    const countdown = setInterval(() => {
        timerDisplay.textContent = `Wait ${remaining}s before next message`;
        remaining--;
        
        if (remaining < 0) {
            clearInterval(countdown);
            timerDisplay.remove();
        }
    }, 1000);
}

// Enhanced addMessage function with error styling
function addMessage(content, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    
    // Special styling for error messages
    let messageClass = 'message-content';
    if (sender.includes('error')) {
        messageClass += ' error-message';
    }
    
    if (sender === 'ai') {
    console.log('AI message detected, applying formatting');
    console.log('Original content:', content);
    const formattedContent = content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/- \*\*([^*]+)\*\*:/g, '<br>â€¢ <strong>$1</strong>:')
        .replace(/^- /gm, 'â€¢ ')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
    console.log('Formatted content:', formattedContent);
    messageDiv.innerHTML = `<div class="${messageClass}"><p>${formattedContent}</p></div>`;
} else {
    console.log('Non-AI message, sender:', sender);
    messageDiv.innerHTML = `<div class="${messageClass}">${content}</div>`;
}
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Add typing indicator function
function addTypingIndicator() {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message ai typing-indicator';
    messageDiv.innerHTML = `
        <div class="message-content">
            <div class="typing-animation">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    `;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    return messageDiv;
}

// Cooldown timer for rate limiting
function startCooldownTimer(seconds) {
    const timerDisplay = document.createElement('div');
    timerDisplay.className = 'cooldown-timer';
    timerDisplay.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff6b6b;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `;
    
    document.body.appendChild(timerDisplay);
    
    let remaining = seconds;
    const countdown = setInterval(() => {
        timerDisplay.textContent = `Wait ${remaining}s before next message`;
        remaining--;
        
        if (remaining < 0) {
            clearInterval(countdown);
            timerDisplay.remove();
        }
    }, 1000);
}

    // Add message to chat
    // Enhanced addMessage function with error styling
//function addMessage(content, sender) {
  //  const messageDiv = document.createElement('div');
    //messageDiv.className = `message ${sender}`;
    
    // Special styling for error messages
    //let messageClass = 'message-content';
    //if (sender.includes('error')) {
        //messageClass += ' error-message';
    //}
    
    //messageDiv.innerHTML = `<div class="${messageClass}">${content}</div>`;
    //chatMessages.appendChild(messageDiv);
    //chatMessages.scrollTop = chatMessages.scrollHeight;
//}
    // Load PDF viewer
    function loadPDFViewer() {
        if (!currentDocumentId) return;
        
        const pdfViewer = document.getElementById('pdfViewer');
        pdfViewer.innerHTML = `
            <iframe
                src="/pdf/${currentDocumentId}"
                width="100%"
                height="100%"
                style="border: none; border-radius: 8px;">
                <p>Your browser doesn't support PDF viewing.
                <a href="/pdf/${currentDocumentId}" target="_blank">Click here to view the PDF</a></p>
            </iframe>
        `;
    }


if (!sessionStorage.getItem('session_id')) {
    const sessionId = generateSessionId();
    fetch('/track', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            event: 'new_visitor',
            session_id: sessionId
        })
    }).catch(() => {});
}


});



// Privacy Policy Demo - Auto-load functionality
window.loadPrivacyPolicyDemo = async function() {
    console.log('Privacy demo function called');
    
    const fileInput = document.getElementById('fileInput');
    
    if (!fileInput) {
        console.error('File input not found');
        alert('Error: File input not found. Please refresh the page.');
        return;
    }

    console.log('Creating privacy policy file...');

    const privacyPolicyText = `Last updated September 06, 2025

# Introduction

Morpha (â€œCompany,â€ â€œwe,â€ â€œus,â€ or â€œourâ€) is committed to protecting your privacy. This Privacy Notice explains how we collect, use, store, and share your information when you use our services, such as when you:
- Visit our website at https://getmorpha.com or any website of ours that links to this Privacy Notice
- Engage with us in other related ways, including any sales, marketing, or events.

If you have any questions, you can contact us at support@getmorpha.com.


# Summary of Key Points

- What personal information do we process? We may process personal information depending on how you interact with the Services.
- Do we process any sensitive personal information? We do not process sensitive personal information.
- Do we collect information from third parties? We do not collect any information from third parties.
- How do we process your information? We process your information to provide, improve, and administer our Services, communicate with you, for security and fraud prevention, and to comply with law. We may also process your information for other purposes with your consent.
- In what situations and with whom do we share personal information? We may share information in specific situations and with specific third parties.
- How do we keep your information safe? We have organizational and technical processes and procedures in place to protect your personal information. However, no electronic transmission or storage system can be guaranteed 100% secure.
- What are your rights? Depending on where you are located, you may have rights regarding your personal information.
- How do you exercise your rights? The easiest way is to contact us at support@getmorpha.com. We will consider and act upon any request in accordance with applicable data protection laws.

# Table of Contents

1. WHAT INFORMATION DO WE COLLECT?
2. HOW DO WE PROCESS YOUR INFORMATION?
3. WHEN AND WITH WHOM DO WE SHARE YOUR PERSONAL INFORMATION?
4. DO WE USE COOKIES AND OTHER TRACKING TECHNOLOGIES?
5. DO WE OFFER ARTIFICIAL INTELLIGENCE-BASED PRODUCTS?
6. HOW LONG DO WE KEEP YOUR INFORMATION?
7. HOW DO WE KEEP YOUR INFORMATION SAFE?
8. DO WE COLLECT INFORMATION FROM MINORS?
9. WHAT ARE YOUR PRIVACY RIGHTS?
10. CONTROLS FOR DO-NOT-TRACK FEATURES
11. DO UNITED STATES RESIDENTS HAVE SPECIFIC PRIVACY RIGHTS?
12. THIRD-PARTY AI PROCESSING (OPENAI)
13. DO WE MAKE UPDATES TO THIS NOTICE?
14. HOW CAN YOU CONTACT US ABOUT THIS NOTICE?

# 1. WHAT INFORMATION DO WE COLLECT?

We collect only the minimum information necessary to provide and improve our Services 
Specific information that we collect:
- Session data: a temporary session identifier (anonymous [randomized non-IP]) that exists only while you're using the service
- Usage analytics: anonymous counts of actions (page visits, document uploads, chat usage, feature clicks)
- Document content: the contracts you upload for analysis (processed in memory, deleted after your session)
- Technical information: browser type, error logs for troubleshooting
Sensitive Information: We do not process sensitive personal information.

# 2. HOW DO WE PROCESS YOUR INFORMATION?

We process your information only for:
- Providing and improving Services
- Security and fraud prevention
- Troubleshooting and customer support
- Compliance with applicable laws

We do not use your data for advertising, profiling, or resale.

Any other use will only occur with your explicit, informed consent.

# 3. WHEN AND WITH WHOM DO WE SHARE YOUR PERSONAL INFORMATION?

We only share your information in limited circumstances:

- Vendors and Service Providers: Bound by strict contractual safeguards and used only for core operations.
- AI Service Providers:
  - OpenAI (API Processing Provider)
    - Purpose: Analyze uploaded contracts to generate summaries, risk flags, and responses.
    - No training: Data is not used to train models.
    - Retention: Inputs/outputs may be retained for up to 30 days solely for abuse monitoring and compliance.
    - Security: Encrypted in transit and at rest.
    - Ownership: You retain full ownership of your content.

We do not sell or broker your personal data.


# 4. DO WE USE COOKIES AND OTHER TRACKING TECHNOLOGIES?

- Only strictly necessary cookies or local storage are used to maintain active sessions.
- No advertising or third-party tracking cookies are used.
- Users may disable cookies without loss of core functionality.

# 5. DO WE OFFER ARTIFICIAL INTELLIGENCE-BASED PRODUCTS?

We use AI (via OpenAI) for text analysis, summarization, and risk flagging. Data is never used to train models and you retain ownership of your content.

To opt out: Contact us at support@getmorpha.com.

# 6. HOW LONG DO WE KEEP YOUR INFORMATION?

In Short: We keep information only as long as necessary.

- Uploaded documents: deleted within 24 hours
- Usage analytics and error logs: retained for up to 2 weeks
- OpenAI API logs: may be retained up to 30 days solely for abuse monitoring and compliance

# 7. HOW DO WE KEEP YOUR INFORMATION SAFE?

We use organizational and technical security measures including encryption and restricted access.

# 8. DO WE COLLECT INFORMATION FROM MINORS?

We do not knowingly collect or market data from children under 18. If discovered, we will delete immediately.

# 9. WHAT ARE YOUR PRIVACY RIGHTS?

You have the right to:
- Access, correct, or delete your data
- Withdraw consent at any time
- Request a copy of your data in a portable format
- Restrict or object to processing

Contact support@getmorpha.com to exercise these rights. Requests are processed promptly and in accordance with data protection laws.

# 10. CONTROLS FOR DO-NOT-TRACK FEATURES

We currently do not respond to DNT signals. However, we limit tracking to strictly necessary session functions only, offering privacy by default.

# 11. DO UNITED STATES RESIDENTS HAVE SPECIFIC PRIVACY RIGHTS?

Yes, residents of CA, CO, CT, DE, FL, IN, IA, KY, MD, MN, MT, NE, NH, NJ, OR, RI, TN, TX, UT, VA may have additional rights.

Categories of Personal Information We Collect:
A. Identifiers (Name, alias, IP, email) - NO
B. Customer Records (Name, contact, employment, financial info) - NO  
C. Protected characteristics (Gender, age, race, marital status) - NO
D. Commercial info (Transactions, purchase history) - NO
E. Biometric info (Fingerprints, voiceprints) - NO
F. Internet/network activity (Browsing history, interactions) - NO
G. Geolocation data (Device location) - NO
H. Audio/sensory (Images, recordings) - NO
I. Employment info (Business contacts, job history) - NO
J. Education info (Student records) - NO
K. Inferences (Preferences, characteristics) - NO
L. Sensitive info - NO

Additional rights include access, correction, deletion, and opt-out of targeted advertising.

# 12. THIRD-PARTY AI PROCESSING (OPENAI)

We use OpenAIâ€™s API for contract analysis:
- No training: Data is not used to train models
- Retention: Inputs/outputs may be retained up to 30 days for abuse monitoring
- Security: Encrypted in transit and at rest
- Ownership: You retain full ownership of your content

# 13. DO WE MAKE UPDATES TO THIS NOTICE?

We may update this Privacy Policy. If material changes occur, users will be informed via prominent in-app notice before changes take effect.

# 14. HOW CAN YOU CONTACT US ABOUT THIS NOTICE?

You can contact us at support@getmorpha.com or by post at Morpha.`;

    // Create a mock PDF file
    const blob = new Blob([privacyPolicyText], { type: 'application/pdf' });
    const file = new File([blob], "Morpha_Privacy_Policy.pdf", { 
        type: "application/pdf",
        lastModified: new Date().getTime()
    });
    
    console.log('File created:', file);
    
    // Set the file programmatically
    const dataTransfer = new DataTransfer();
    dataTransfer.items.add(file);
    fileInput.files = dataTransfer.files;
    
    // Set upload type
    fileInput.dataset.uploadType = 'initial';
    
    console.log('Triggering file upload...');
    
    // Trigger the file upload
    const event = new Event('change', { bubbles: true });
    fileInput.dispatchEvent(event);
}

// Make sure the button click handler is properly attached
document.addEventListener('DOMContentLoaded', function() {
    // Wait a bit to ensure everything is loaded
    setTimeout(() => {
        const demoBtn = document.getElementById('demoPrivacyBtn');
        console.log('Demo button found:', demoBtn);
        
        if (demoBtn) {
            demoBtn.addEventListener('click', function(e) {
                console.log('Demo button clicked');
                e.preventDefault();
                window.loadPrivacyPolicyDemo();
            });
            console.log('Click handler attached to demo button');
        } else {
            console.error('Demo button not found in DOM');
        }
    }, 500);

    // Feedback functionality - MOVED INSIDE THE SAME BLOCK
    const feedbackBtn = document.getElementById('feedbackBtn');
    const feedbackModal = document.getElementById('feedbackModal');
    const closeFeedback = document.getElementById('closeFeedback');
    const cancelFeedback = document.getElementById('cancelFeedback');
    const feedbackForm = document.getElementById('feedbackForm');

    if (feedbackBtn && feedbackModal) {
        // Open feedback modal
        feedbackBtn.addEventListener('click', () => {
            console.log('Feedback button clicked!'); // Debug line
            feedbackModal.style.display = 'flex';
        });

        // Close feedback modal
        function closeFeedbackModal() {
            feedbackModal.style.display = 'none';
            feedbackForm.reset();
        }

        closeFeedback.addEventListener('click', closeFeedbackModal);
        cancelFeedback.addEventListener('click', closeFeedbackModal);

        // Close modal when clicking outside
        feedbackModal.addEventListener('click', (e) => {
            if (e.target === feedbackModal) {
                closeFeedbackModal();
            }
        });

        // Handle form submission
        feedbackForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = feedbackForm.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';

            const formData = {
                type: document.getElementById('feedbackType').value,
                message: document.getElementById('feedbackMessage').value,
                userEmail: document.getElementById('userEmail').value,
                currentPage: window.location.href,
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch('/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    alert('Thank you for your feedback! We\'ll review it soon.');
                    closeFeedbackModal();
                } else {
                    throw new Error(result.error || 'Failed to send feedback');
                }
            } catch (error) {
                console.error('Feedback error:', error);
                alert('Failed to send feedback. Please try again or email us directly at support@getmorpha.com');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Feedback';
            }
        });
    } else {
        console.log('Feedback elements not found:', {feedbackBtn, feedbackModal}); // Debug line
    }
});

// Mobile functionality - Fixed scope issues
    function initializeMobileControls() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileChatBtn = document.getElementById('mobileChatBtn');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const mobileSidebar = document.getElementById('sidebar');
        let mobileState = {
            sidebarOpen: false
        };

        // Mobile menu toggle
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', function() {
                mobileState.sidebarOpen = !mobileState.sidebarOpen;
                
                if (mobileState.sidebarOpen) {
                    mobileSidebar.classList.add('mobile-open');
                    mobileOverlay.classList.add('active');
                } else {
                    mobileSidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                }
            });
        }

        // Close mobile sidebar when overlay is clicked
        if (mobileOverlay) {
            mobileOverlay.addEventListener('click', function() {
                mobileState.sidebarOpen = false;
                mobileSidebar.classList.remove('mobile-open');
                mobileOverlay.classList.remove('active');
            });
        }

        // Mobile chat button functionality
        if (mobileChatBtn) {
            mobileChatBtn.addEventListener('click', function() {
                // Check if we have a document by looking at the DOM instead
                const documentTitle = document.getElementById('documentTitle');
                const hasDocument = documentTitle && documentTitle.textContent !== 'Contract Analysis';
                
                if (!hasDocument) {
                    alert('Please upload a document first to start chatting.');
                    return;
                }
                
                // Create mobile chat modal
                openMobileChatModal();
            });
        }

        // Mobile chat modal function
        function openMobileChatModal() {
            const chatModal = document.createElement('div');
            chatModal.className = 'mobile-chat-modal';
            chatModal.innerHTML = `
                <div class="mobile-chat-content">
                    <div class="mobile-chat-header">
                        <h3>Chat with Document</h3>
                        <button class="mobile-chat-close">&times;</button>
                    </div>
                    <div class="mobile-chat-messages" id="mobileChatMessages">
                        ${document.getElementById('chatMessages').innerHTML}
                    </div>
                    <div class="mobile-suggested-questions">
                        ${document.getElementById('suggestedQuestions').innerHTML}
                    </div>
                    <div class="mobile-chat-input">
                        <input type="text" id="mobileChatInput" placeholder="Ask a question...">
                        <button id="mobileSendBtn">Send</button>
                    </div>
                </div>
            `;

            document.body.appendChild(chatModal);

            // FIXED: Auto-refresh mobile chat every 2 seconds while modal is open
            const refreshInterval = setInterval(() => {
                const mobileChatMessages = chatModal.querySelector('#mobileChatMessages');
                const mainChatMessages = document.getElementById('chatMessages');
                if (mobileChatMessages && mainChatMessages) {
                    mobileChatMessages.innerHTML = mainChatMessages.innerHTML;
                    mobileChatMessages.scrollTop = mobileChatMessages.scrollHeight;
                }
            }, 2000);

            // Make suggested questions clickable in mobile modal
            const mobileSuggestionBtns = chatModal.querySelectorAll('.suggestion-btn');
            mobileSuggestionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const question = this.textContent.trim(); // FIXED: was 'message', now 'question'
                    const mainChatInput = document.getElementById('chatInput');
                    const mainSendBtn = document.getElementById('sendBtn');

                    if (mainChatInput && mainSendBtn) {
                        mainChatInput.value = question; // FIXED: was 'message', now 'question'
                        mainSendBtn.click();
                    }
                });
            });

            // Close modal functionality
            chatModal.querySelector('.mobile-chat-close').addEventListener('click', function() {
                clearInterval(refreshInterval); // FIXED: Stop refresh when modal closes
                document.body.removeChild(chatModal);
            });

            // Mobile chat input functionality
            const mobileChatInput = chatModal.querySelector('#mobileChatInput');
            const mobileSendBtn = chatModal.querySelector('#mobileSendBtn');

            mobileSendBtn.addEventListener('click', function() {
                const userMessage = mobileChatInput.value.trim();
                if (userMessage) {
                    const mainChatInput = document.getElementById('chatInput');
                    const mainSendBtn = document.getElementById('sendBtn');

                    if (mainChatInput && mainSendBtn) {
                        mainChatInput.value = userMessage;
                        mainSendBtn.click();
                        mobileChatInput.value = '';
                    }
                }
            });

            mobileChatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    mobileSendBtn.click();
                }
            });
        }
    }

    // Initialize mobile controls
    initializeMobileControls();

</script>

<!-- Feedback Modal -->
<div id="feedbackModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Share Your Feedback</h3>
            <span class="close" id="closeFeedback">&times;</span>
        </div>
        <div class="modal-body">
            <form id="feedbackForm">
                <div class="form-group">
                    <label for="feedbackType">What type of feedback?</label>
                    <select id="feedbackType" required>
                        <option value="">Select type...</option>
                        <option value="bug">Bug Report</option>
                        <option value="feature">Feature Request</option>
                        <option value="general">General Feedback</option>
                        <option value="complaint">Issue/Complaint</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="feedbackMessage">Your feedback:</label>
                    <textarea id="feedbackMessage" rows="6" placeholder="Tell us what you think..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="userEmail">Your email (optional):</label>
                    <input type="email" id="userEmail" placeholder="your@email.com" />
                </div>
                <div class="form-actions">
                    <button type="button" id="cancelFeedback" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary">Send Feedback</button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>
</html>